# Контроллеры

## Запуск валидатора в режиме работы контроллеров

1. Подготовьте аппаратное обеспечение для валидатора - 32 виртуальных ядер, 64GB памяти, 1TB SSD, фиксированный IP-адрес, скорость интернета 1Gb/s.

   Для поддержания стабильности сети рекомендуется разместить валидаторы в различных местах по всему миру, а не концентрировать их в одном дата-центре. Вы можете использовать [этот сайт](https://status.toncenter.com/) для определения нагрузки на различные места. Согласно карте, высокая нагрузка на дата-центры в Европе, особенно в Финляндии, Германии и Париже. Поэтому использование провайдеров, таких как Hetzner и OVH, не рекомендуется.

   > Ваше оборудование должно соответствовать указанной конфигурации или быть выше. Запуск валидатора на слабом оборудовании негативно влияет на сеть и может привести к штрафам.

   > С мая 2021 года Hetzner запретил майнинг на своих серверах, в настоящее время под это правило попадают алгоритмы PoW и PoS. Установка даже обычного узла будет считаться нарушением условий договора.

2. Установите и синхронизируйте **mytonctrl** в соответствии с описанием в [этой инструкции](https://github.com/ton-blockchain/mytonctrl/blob/master/docs/ru/manual-ubuntu.md) — следуйте **только** пунктам 1, 2 и 3.

   Вы также можете обратиться к этой [Видеоинструкции](https://docs.ton.org/participate/run-nodes/full-node#installation) для дополнительной помощи.

3. Переведите 1 TON на адрес кошелька валидатора, который отображается в списке `wl`.

4. Используйте команду `aw` для активации кошелька валидатора.

5. Переведите достаточно TON на адрес кошелька валидатора.

6. Включите ton-http-api службу:
	```
	mytonctrl -> installer -> enable THA
	```
	Выйдите из режима установщика сочетанием клавиш `Ctrl+D`

7. Задайте адрес ликвидного пула, который будет одалживать TON для валидации:
	```
	set liquid_pool_addr <liquid-pool-address>
	```

8. Задайте параметры кредитования, которые вам подходят:
	```
	set min_loan 41000
	set max_loan 43000
	set max_interest_percent 1.5
	```
	
	где 
* `41000` - это минимальная сумма кредита который мы готовы получить у ликвидного пула,
*	`43000` - это максимальная сумма кредита который мы готовы получить у ликвидного пула,
*	`1.5` - это максимальная процентная ставка ликвидного пула за один цикл валидации на которую мы согласны.

9. Отобразите годовой процент прибыли от ликвидного пула:
	```
	calculate_annual_controller_percentage
	```

10. Создайте два контроллера одной командой:
   
   ```
   new_controllers
   ```

11. Введите `controllers_list` чтобы отобразить адреса контроллеров:

   ```
   controllers_list
   Address                                             Status  Balance
   kf89KYOeRPRRDyjt_3bPsz92cKSghRqw64efNr8mT1eeHDaS    active  0.704345
   kf_lT8QNykLh5PN5ictNX22maiyIf9iK787fXg6nJ_zB-jbN    active  0.720866
   ```

12. Совершите депозит валидатора в каждый контроллер:
   
   ```
   deposit_to_controller kf89KYOeRPRRDyjt_3bPsz92cKSghRqw64efNr8mT1eeHDaS 10000
   deposit_to_controller kf_lT8QNykLh5PN5ictNX22maiyIf9iK787fXg6nJ_zB-jbN 10000
   ```
   
   где `10000` TON - это сумма депозита.

13. Получите аппрувал контроллеров. У каждого пула может быть своя политика выдачи аппруволов, уточняйте у оператора.

14. Активируйте режим работы контроллеров:

    ```bash
    set useController true
    set stake null
    ```
	
	> (!) Если до этого вы использовали номинатор-пулы, не забудьте отключить их использование командой `set usePool false`.


## Переключение обычного валидатора в режим работы контроллеров

1. Введите `set stake 0`, чтобы отключить участие в выборах.

2. Дождитесь, когда оба ваших депозита вернутся от электора.

3. Следуйте инструкциям "Запуск валидатора в режиме работы контроллеров", начиная с **6-го шага**.
